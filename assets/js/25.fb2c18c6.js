(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{436:function(t,s){t.exports="data:image/jpeg;base64,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"},437:function(t,s,a){t.exports=a.p+"assets/img/2.e368f6a8.jpg"},551:function(t,s,a){"use strict";a.r(s);var n=a(24),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"响应式系统的依赖收集追踪原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#响应式系统的依赖收集追踪原理"}},[t._v("#")]),t._v(" 响应式系统的依赖收集追踪原理")]),t._v(" "),n("h2",{attrs:{id:"为什么要依赖收集"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么要依赖收集"}},[t._v("#")]),t._v(" 为什么要依赖收集？")]),t._v(" "),n("h3",{attrs:{id:"先举个栗子🌰"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#先举个栗子🌰"}},[t._v("#")]),t._v(" 先举个栗子🌰")]),t._v(" "),n("p",[t._v("我们现在有这么一个 Vue 对象。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    template"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" \n        "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<div>\n            <span>{{text1}}</span> \n            <span>{{text2}}</span> \n        <div>")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        text1"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        text2"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        text3"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text3'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("然后我们做了这么一个操作。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text3 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'modify text3'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("我们修改了 data 中 text3 的数据，但是因为视图中并不需要用到 text3 ，所以我们并不需要触发上一章所讲的 cb 函数来更新视图，调用 cb 显然是不正确的。")]),t._v(" "),n("h3",{attrs:{id:"再来一个栗子🌰"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#再来一个栗子🌰"}},[t._v("#")]),t._v(" 再来一个栗子🌰")]),t._v(" "),n("p",[t._v("假设我们现在有一个全局的对象，我们可能会在多个 Vue 对象中用到它进行展示。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" globalObj "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    text1"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text1'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" o1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    template"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<div>\n            <span>{{text1}}</span> \n        <div>")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" globalObj\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" o2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    template"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<div>\n            <span>{{text1}}</span> \n        <div>")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" globalObj\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("这个时候，我们执行了如下操作。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("globalObj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello,text1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("我们应该需要通知 o1 以及 o2 两个vm实例进行视图的更新，「依赖收集」会让 text1 这个数据知道“哦～有两个地方依赖我的数据，我变化的时候需要通知它们～”。")]),t._v(" "),n("p",[t._v("最终会形成数据与视图的一种对应关系，如下图。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(436),alt:"1"}})]),t._v(" "),n("p",[t._v("接下来我们来介绍一下「依赖收集」是如何实现的。")]),t._v(" "),n("h2",{attrs:{id:"订阅者-dep"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#订阅者-dep"}},[t._v("#")]),t._v(" 订阅者 Dep")]),t._v(" "),n("p",[t._v("首先我们来实现一个订阅者 Dep ，它的主要作用是用来存放 Watcher 观察者对象。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Dep")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 用来存放Watcher对象的数组 */")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 在subs中添加一个Watcher对象 */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSub")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sub")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 通知所有Watcher对象更新视图 */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("notify")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sub")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            sub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("为了便于理解我们只实现了添加的部分代码，主要是两件事情：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("用 addSub 方法可以在目前的 Dep 对象中增加一个 Watcher 的订阅操作；")])]),t._v(" "),n("li",[n("p",[t._v("用 notify 方法通知目前 Dep 对象的 subs 中的所有 Watcher 对象触发更新操作。")])])]),t._v(" "),n("h2",{attrs:{id:"观察者-watcher"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#观察者-watcher"}},[t._v("#")]),t._v(" 观察者 Watcher")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 在new一个Watcher对象时将该对象赋值给Dep.target，在get中会用到 */")]),t._v("\n        Dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 更新视图的方法 */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"视图更新啦～"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nDep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"依赖收集"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#依赖收集"}},[t._v("#")]),t._v(" 依赖收集")]),t._v(" "),n("p",[t._v("接下来我们修改一下 defineReactive 以及 Vue 的构造函数，来完成依赖收集。")]),t._v(" "),n("p",[t._v("我们在闭包中增加了一个 Dep 类的对象，用来收集 Watcher 对象。在对象被「读」的时候，会触发 reactiveGetter 函数把当前的 Watcher 对象（存放在 Dep.target 中）收集到 Dep 类中去。之后如果当该对象被「写」的时候，则会触发 reactiveSetter 方法，通知 Dep 类调用 notify 来触发所有 Watcher 对象的 update 方法更新对应视图。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineReactive")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 一个Dep类对象 */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dep "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Dep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        enumerable"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        configurable"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reactiveGetter")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 将Dep.target（即当前的Watcher对象存入dep的subs中） */")]),t._v("\n            dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSub")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         \n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reactiveSetter")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("newVal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newVal "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 在set的时候触发dep的notify来通知所有的Watcher对象更新视图 */")]),t._v("\n            dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("notify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("observer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 新建一个Watcher观察者对象，这时候Dep.target会指向这个Watcher对象 */")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 在这里模拟render的过程，为了触发test属性的get函数 */")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'render~'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"完整代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#完整代码"}},[t._v("#")]),t._v(" 完整代码")]),t._v(" "),n("p",[t._v("部分代码有调整：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Dep")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用来存放 Watcher 对象的数组")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在 subs 中添加一个 Watcher 对象")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSub")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sub")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通知所有的 Watcher 对象更新视图")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("notify")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sub")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      sub"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// new Watcher 对象的时候，把该对象赋值给 Dep.target, 在 get 中会用到")]),t._v("\n    Dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cb "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cb\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("obj "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" key\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 触发 defineProperty 的 get 方法")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Dep 添加 watcher 完成")]),t._v("\n    Dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nDep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以把他理解为一个全局变量")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineReactive")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一个 Dep 类对象")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dep "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Dep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    enumerable"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 属性可枚举")]),t._v("\n    configurable"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 属性可修改或者删除")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reactiveGetter")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 将Dep.target（即当前的Watcher对象存入dep的subs中） */")]),t._v("\n      dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSub")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" val\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("set")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reactiveSetter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("newVal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newVal "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      val "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newVal\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 在set的时候触发dep的notify来通知所有的Watcher对象更新视图 */")]),t._v("\n      dep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("notify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("observer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'object'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineReactive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_data "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("observer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 新建一个Watcher观察者对象，这时候Dep.target会指向这个Watcher对象 */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test 视图更新啦'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 在这里模拟render的过程，为了触发test属性的 set 函数 */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'abc'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" vue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    test"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"I am test."')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),n("p",[t._v("总结一下。")]),t._v(" "),n("p",[t._v("首先在 observer 的过程中会注册 get 方法，该方法用来进行「依赖收集」。在它的闭包中会有一个 Dep 对象，这个对象用来存放 Watcher 对象的实例。其实「依赖收集」的过程就是把 Watcher 实例存放到对应的 Dep 对象中去。get 方法可以让当前的 Watcher 对象（Dep.target）存放到它的 subs 中（addSub）方法，在数据变化时，set 会调用 Dep 对象的 notify 方法通知它内部所有的 Watcher 对象进行视图更新。")]),t._v(" "),n("p",[t._v("这是 Object.defineProperty 的 set/get 方法处理的事情，那么「依赖收集」的前提条件还有两个：")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("触发 get 方法；")])]),t._v(" "),n("li",[n("p",[t._v("新建一个 Watcher 对象。")])])]),t._v(" "),n("p",[t._v("这个我们在 Vue 的构造类中处理。新建一个 Watcher 对象只需要 new 出来，这时候 Dep.target 已经指向了这个 new 出来的 Watcher 对象来。而触发 get 方法也很简单，实际上只要把 render function 进行渲染，那么其中的依赖的对象都会被「读取」，这里我们通过打印来模拟这个过程，读取 test 来触发 get 进行「依赖收集」。")]),t._v(" "),n("p",[t._v("本章我们介绍了「依赖收集」的过程，配合之前的响应式原理，已经把整个「响应式系统」介绍完毕了。其主要就是 get 进行「依赖收集」。set 通过观察者来更新视图，配合下图仔细捋一捋，相信一定能搞懂它！")]),t._v(" "),n("p",[n("img",{attrs:{src:a(437),alt:"2"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);