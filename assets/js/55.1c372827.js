(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{353:function(t,s){t.exports="data:image/jpeg;base64,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"},477:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"回流和重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回流和重绘"}},[t._v("#")]),t._v(" 回流和重绘")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("回流：当我们对 DOM 的修改引发了 DOM 几何尺寸的变化（比如修改元素的宽、高或隐藏元素等）时，浏览器需要重新计算元素的几何属性（其他元素的几何属性和位置也会因此受到影响），然后再将计算的结果绘制出来。这个过程就是回流（也叫重排）。")])]),t._v(" "),s("li",[s("p",[t._v("重绘：当我们对 DOM 的修改导致了样式的变化、却并未影响其几何属性（比如修改了颜色或背景色）时，浏览器不需重新计算元素的几何属性、直接为该元素绘制新的样式（跳过了上图所示的回流环节）。这个过程叫做重绘。")])])]),t._v(" "),s("p",[t._v("由此我们可以看出，重绘不一定导致回流，回流一定会导致重绘。硬要比较的话，回流比重绘做的事情更多，带来的开销也更大。但这两个说到底都是吃性能的，所以都不是什么善茬。我们在开发中，要从代码层面出发，尽可能把回流和重绘的次数最小化。")]),t._v(" "),s("h2",{attrs:{id:"哪些实际操作会导致回流与重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#哪些实际操作会导致回流与重绘"}},[t._v("#")]),t._v(" 哪些实际操作会导致回流与重绘")]),t._v(" "),s("p",[t._v("要避免回流与重绘的发生，最直接的做法是避免掉可能会引发回流与重绘的 DOM 操作，就好像拆弹专家在解决一颗炸弹时，最重要的是掐灭它的导火索。")]),t._v(" "),s("p",[t._v("触发重绘的“导火索”比较好识别——只要是不触发回流，但又触发了样式改变的 DOM 操作，都会引起重绘，比如背景色、文字色、可见性(可见性这里特指形如visibility: hidden这样不改变元素位置和存在性的、单纯针对可见性的操作，注意与display:none进行区分)等。为此，我们要着重理解一下那些可能触发回流的操作。")]),t._v(" "),s("h3",{attrs:{id:"回流的-导火索"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回流的-导火索"}},[t._v("#")]),t._v(" 回流的“导火索”")]),t._v(" "),s("ul",[s("li",[t._v("最“贵”的操作：改变 DOM 元素的几何属性")])]),t._v(" "),s("p",[t._v("这个改变几乎可以说是“牵一发动全身”——当一个DOM元素的几何属性发生变化时，所有和它相关的节点（比如父子节点、兄弟节点等）的几何属性都需要进行重新计算，它会带来巨大的计算量。")]),t._v(" "),s("p",[t._v("常见的几何属性有 width、height、padding、margin、left、top、border 等等。此处不再给大家一一列举。有的文章喜欢罗列属性表格，但我相信我今天列出来大家也不会看、看了也记不住（因为太多了）。我自己也不会去记这些——其实确实没必要记，️一个属性是不是几何属性、会不会导致空间布局发生变化，大家写样式的时候完全可以通过代码效果看出来。多说无益，还希望大家可以多写多试，形成自己的“肌肉记忆”。")]),t._v(" "),s("ul",[s("li",[t._v("“价格适中”的操作：改变 DOM 树的结构")])]),t._v(" "),s("p",[t._v("这里主要指的是节点的增减、移动等操作。浏览器引擎布局的过程，顺序上可以类比于树的层序遍历——它是一个从上到下、从左到右的过程。通常在这个过程中，当前元素不会再影响其前面已经遍历过的元素。")]),t._v(" "),s("ul",[s("li",[t._v("最容易被忽略的操作：获取一些特定属性的值")])]),t._v(" "),s("p",[t._v("当你要用到像这样的属性：offsetTop、offsetLeft、 offsetWidth、offsetHeight、scrollTop、scrollLeft、scrollWidth、scrollHeight、clientTop、clientLeft、clientWidth、clientHeight 时，你就要注意了！")]),t._v(" "),s("p",[t._v("“像这样”的属性，到底是像什么样？——这些值有一个共性，就是需要通过即时计算得到。因此浏览器为了获取这些值，也会进行回流。")]),t._v(" "),s("p",[t._v("除此之外，当我们调用了 getComputedStyle 方法，或者 IE 里的 currentStyle 时，也会触发回流。原理是一样的，都为求一个“即时性”和“准确性”。")]),t._v(" "),s("h2",{attrs:{id:"如何规避回流与重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何规避回流与重绘"}},[t._v("#")]),t._v(" 如何规避回流与重绘")]),t._v(" "),s("p",[t._v("了解了回流与重绘的“导火索”，我们就要尽量规避它们。但很多时候，我们不得不使用它们。当避无可避时，我们就要学会更聪明地使用它们。")]),t._v(" "),s("h3",{attrs:{id:"将-导火索-缓存起来-避免频繁改动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将-导火索-缓存起来-避免频繁改动"}},[t._v("#")]),t._v(" 将“导火索”缓存起来，避免频繁改动")]),t._v(" "),s("p",[t._v("bad:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取el元素")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" el "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'el'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里循环判定比较简单，实际中或许会拓展出比较复杂的判定需求")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("offsetTop  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("offsetLeft "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("good:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缓存offsetLeft与offsetTop的值")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" el "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'el'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" offLeft "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("offsetLeft"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" offTop "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("offsetTop\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在JS层面进行计算")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  offLeft "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n  offTop  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一次性将计算结果应用到DOM上")]),t._v("\nel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" offLeft "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),t._v("\nel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" offTop  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"px"')]),t._v("\n")])])]),s("h3",{attrs:{id:"避免逐条改变样式-使用类名去合并样式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#避免逐条改变样式-使用类名去合并样式"}},[t._v("#")]),t._v(" 避免逐条改变样式，使用类名去合并样式")]),t._v(" "),s("p",[t._v("比如我们可以把这段单纯的代码：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" container "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'container'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'100px'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'200px'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("border "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10px solid red'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("color "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'red'")]),t._v("\n")])])]),s("p",[t._v("优化成一个有 class 加持的样子：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("style")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token style"}},[s("span",{pre:!0,attrs:{class:"token language-css"}},[t._v("\n    "),s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".basic_style")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 100px"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("height")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 200px"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("border")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10px solid red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("color")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  ")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("style")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}},[s("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" container "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'container'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'basic_style'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  ")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("前者每次单独操作，都去触发一次渲染树更改，从而导致相应的回流与重绘过程。")]),t._v(" "),s("p",[t._v("合并之后，等于我们将所有的更改一次性发出，用一个 style 请求解决掉了。")]),t._v(" "),s("h3",{attrs:{id:"将-dom-离线"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将-dom-离线"}},[t._v("#")]),t._v(" 将 DOM “离线”")]),t._v(" "),s("p",[t._v("我们上文所说的回流和重绘，都是在“该元素位于页面上”的前提下会发生的。一旦我们给元素设置 display: none，将其从页面上“拿掉”，那么我们的后续操作，将无法触发回流与重绘——这个将元素“拿掉”的操作，就叫做 DOM 离线化。")]),t._v(" "),s("p",[t._v("仍以我们上文的代码片段为例：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" container "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'container'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'100px'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'200px'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("border "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10px solid red'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("color "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'red'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("（省略了许多类似的后续操作）\n")])])]),s("p",[t._v("离线化后就是这样：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" container "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'container'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'100px'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'200px'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("border "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10px solid red'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("color "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'red'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("（省略了许多类似的后续操作）\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'block'")]),t._v("\n")])])]),s("p",[t._v("有的同学会问，拿掉一个元素再把它放回去，这不也会触发一次昂贵的回流吗？这话不假，但我们把它拿下来了，后续不管我操作这个元素多少次，每一步的操作成本都会非常低。当我们只需要进行很少的 DOM 操作时，DOM 离线化的优越性确实不太明显。但是一旦操作频繁起来，这“拿掉”和“放回”的开销都将会是非常值得的。")]),t._v(" "),s("h2",{attrs:{id:"flush-队列-浏览器并没有那么简单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flush-队列-浏览器并没有那么简单"}},[t._v("#")]),t._v(" Flush 队列：浏览器并没有那么简单")]),t._v(" "),s("p",[t._v("以我们现在的知识基础，理解上面的优化操作并不难。那么现在我问大家一个问题：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" container "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'container'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'100px'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'200px'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("border "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'10px solid red'")]),t._v("\ncontainer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("color "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'red'")]),t._v("\n")])])]),s("p",[t._v("这段代码里，浏览器进行了多少次的回流或重绘呢？")]),t._v(" "),s("p",[t._v("“width、height、border是几何属性，各触发一次回流；color只造成外观的变化，会触发一次重绘。”——如果你立刻这么想了，说明你是个能力不错的同学，认真阅读了前面的内容。那么我们现在立刻跑一跑这段代码，看看浏览器怎么说：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(353),alt:""}})]),t._v(" "),s("p",[t._v("这里为大家截取有“Layout”和“Paint”出镜的片段（这个图是通过 Chrome 的 Performance 面板得到的，后面会教大家用这个东西）。我们看到浏览器只进行了一次回流和一次重绘——和我们想的不一样啊，为啥呢？")]),t._v(" "),s("p",[t._v("因为现代浏览器是很聪明的。浏览器自己也清楚，如果每次 DOM 操作都即时地反馈一次回流或重绘，那么性能上来说是扛不住的。于是它自己缓存了一个 flush 队列，把我们触发的回流与重绘任务都塞进去，待到队列里的任务多起来、或者达到了一定的时间间隔，或者“不得已”的时候，再将这些任务一口气出队。因此我们看到，上面就算我们进行了 4 次 DOM 更改，也只触发了一次 Layout 和一次 Paint。")]),t._v(" "),s("p",[t._v("大家这里尤其小心这个“不得已”的时候。前面我们在介绍回流的“导火索”的时候，提到过有一类属性很特别，它们有很强的“即时性”。当我们访问这些属性时，浏览器会为了获得此时此刻的、最准确的属性值，而提前将 flush 队列的任务出队——这就是所谓的“不得已”时刻。具体是哪些属性值，我们已经在“最容易被忽略的操作”这个小模块介绍过了，此处不再赘述。")])])}),[],!1,null,null,null);s.default=e.exports}}]);